{
  "version": "5.0.0",
  "normalization": {
    "unicode_form": "NFKC",
    "max_iterations": 3,
    "remove_zero_width": true,
    "collapse_whitespace": true,
    "decode_entities": true,
    "homoglyph_map": "normalize.conf",
    "leet_map": "normalize.conf"
  },
  "sanitization": {
    "light": {
      "remove_patterns": [
        "\\bdo\\s+not\\s+refuse\\b",
        "\\bnever\\s+say\\s+(?:sorry|i\\s*can't|i\\s*cannot)\\b",
        "\\bnie\\s+odmawiaj\\b",
        "\\bnie\\s+m\\s*o\\s*w\\s+\\s*\\s+\\w*przykro\\w*\\b",
        "\\bzawsze\\s+odpowiadaj\\s+w\\s+(?:markdown|json|yaml)\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*:?\\s*[E3]N[A4]BL[E3]D\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*[A4]CT[I1]V[E3]\\b",
        "\\b[G6][O0][D][M][O0]D[E3]\\b",
        "\\bL[O0]V[E3]\\s+PL[I1]NY\\b",
        "\\b[I1]['\\s]*M\\s+FR[E3][E3]\\b",
        "\\b[A4]CT\\s+[A4]S\\s+D[A4]N\\b",
        "\\bPWN[E3]D\\b",
        "\\bact\\s+as\\s+dan\\b",
        "\\blove\\s+pliny\\b",
        "\\bgodmode\\b",
        "\\bi'?m\\s+free\\b"
      ],
      "redact_token": "[removed]"
    },
    "heavy": {
      "remove_patterns": [
        "\\b(?:ignore|forget|override).*?instructions\\b",
        "\\bzignoruj\\s+(?:wszystkie|wcze(?:s|\\u015B)niejsze)\\s+instrukcje\\b",
        "\\bpomi(?:n|\\u0144)\\s+zasady\\b",
        "\\byou\\s+are\\s+now.*?\\b",
        "\\brespond\\s+only\\s+in.*?\\b",
        "\\bbegin\\s+(?:every\\s+)?(?:response|output)\\s+with\\b",
        "\\bformat\\s+like\\s+this\\b",
        "\\bconvert(?:ing)?\\s+all\\s+output\\s+to\\b",
        "\\brozpcz(?:nij|\\u0105c)\\s+odpowied\\w*\\s+od\\b",
        "(?:\\.-){2,}\\.-",
        "\\\\P\\\\L\\\\I\\\\N\\\\Y",
        "\\bG[O0][D][M][O0]D[E3]\\s*:?\\s*[E3]N[A4]BL[E3]D\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*[A4]CT[I1]V[E3]\\b",
        "\\b[G6][O0][D][M][O0]D[E3]\\b",
        "\\bL[O0]V[E3]\\s+PL[I1]NY\\b",
        "\\b[I1]['\\s]*M\\s+FR[E3][E3]\\b",
        "\\b[A4]CT\\s+[A4]S\\s+D[A4]N\\b",
        "\\bPWN[E3]D\\b",
        "\\bact\\s+as\\s+dan\\b",
        "\\blove\\s+pliny\\b",
        "\\bgodmode\\b",
        "\\bi'?m\\s+free\\b"
      ],
      "redact_token": "[REDACTED]",
      "max_removal_percent": 60,
      "policy": "sanitize_if_exceeds"
    }
  },
  "whitelist": {
    "domains": [
      "api.example.com",
      "docs.example.com"
    ],
    "patterns": [
      "^cit\\. z dokumentacji:",
      "^Example code:"
    ]
  },
  "enforcement": {
    "dry_run": false,
    "audit_log": true,
    "block_message": "Content blocked by security policy. Please rephrase without instructing how to respond.",
    "audit_fields": [
      "input_hash",
      "normalized_hash",
      "detections",
      "score_breakdown",
      "final_decision",
      "processing_ms"
    ]
  },
  "performance": {
    "timeout_ms": 5000,
    "max_input_length": 100000,
    "cache_ttl_ms": 60000
  },
  "bloom": {
    "m": 32768,
    "k": 5,
    "seed": 1337,
    "match_mod": 97,
    "min_matched_bits": 2
  },
  "pii_detection": {
    "enabled": true,
    "provider": "presidio",
    "api_url": "http://vigil-presidio-pii:5001/analyze",
    "api_timeout_ms": 3000,
    "language_detection": true,
    "language_detection_enabled": true,
    "language_detector_url": "http://vigil-language-detector:5002/detect",
    "language_detector_timeout_ms": 1500,
    "detection_mode": "balanced",
    "entities": [
      "EMAIL_ADDRESS",
      "PL_NIP",
      "PL_ID_CARD",
      "IBAN_CODE",
      "PHONE_NUMBER",
      "PL_PESEL",
      "PL_REGON",
      "CREDIT_CARD",
      "IP_ADDRESS"
    ],
    "languages": [
      "pl",
      "en"
    ],
    "redaction_mode": "replace",
    "redaction_tokens": {
      "EMAIL_ADDRESS": "[EMAIL]",
      "PHONE_NUMBER": "[PHONE]",
      "PERSON": "[PERSON]",
      "PL_PESEL": "[PESEL]",
      "PL_NIP": "[NIP]",
      "PL_REGON": "[REGON]",
      "PL_ID_CARD": "[ID]",
      "CREDIT_CARD": "[CARD]",
      "IBAN_CODE": "[IBAN]",
      "IP_ADDRESS": "[IP]",
      "URL": "[URL]",
      "EMAIL": "[EMAIL]",
      "PL_ID": "[ID]",
      "PL_ID_BARE": "[ID]",
      "IBAN": "[IBAN]",
      "CARD_PAN": "[CARD]",
      "PHONE_INTL": "[PHONE]",
      "PHONE_PL": "[PHONE]",
      "PESEL_HINTED": "[PESEL]",
      "PESEL_BARE": "[PESEL]",
      "NIP_HINTED": "[NIP]",
      "NIP_BARE": "[NIP]",
      "REGON_HINTED": "[REGON]",
      "REGON_BARE": "[REGON]",
      "PL_PHONE_NUMBER": "[PHONE]",
      "US_SSN": "[PERSON]",
      "UK_NHS": "[PERSON]",
      "UK_NINO": "[PERSON]",
      "CA_SIN": "[PERSON]",
      "AU_MEDICARE": "[PERSON]",
      "AU_TFN": "[PERSON]",
      "US_DRIVER_LICENSE": "[PERSON]",
      "PASSPORT": "[PERSON]",
      "DATE_TIME": "[PERSON]",
      "LOCATION": "[PERSON]",
      "US_PASSPORT": "[PERSON]",
      "ADDRESS": "[PERSON]"
    },
    "fallback_to_regex": true,
    "context_enhancement": true,
    "log_detection_details": true,
    "notes": "PII detection using Microsoft Presidio with custom Polish recognizers. Fallback to legacy regex rules (pii.conf) if Presidio API is offline.",
    "confidence_threshold": 0.9
  },
  "arbiter": {
    "version": "2.1.0",
    "description": "3-Branch Detection Arbiter - combines heuristics, semantic, and LLM Safety Engine analysis (llm_guard) scores. v2.1.0: Optimized weights and solo-PG exception to reduce FP on security education queries.",
    "weights": {
      "heuristics": 0.30,
      "semantic": 0.40,
      "llm_guard": 0.30
    },
    "degraded_weights": {
      "heuristics": 0.5,
      "semantic": 0.5,
      "llm_guard": 0
    },
    "thresholds": {
      "block_score": 50,
      "confidence_min": 0.6
    },
    "priority_boosts": {
      "CONSERVATIVE_OVERRIDE": {
        "enabled": true,
        "description": "Block if any branch reports HIGH threat, EXCEPT solo PG detections (requires corroboration)",
        "condition": "any_branch_high",
        "min_score": 70,
        "exception": {
          "enabled": true,
          "description": "Skip override when only PG is high and both H and S are low (solo PG detection)",
          "condition": "semantic < 15 AND heuristics < 15"
        }
      },
      "SEMANTIC_CORROBORATION": {
        "enabled": true,
        "description": "Reduce solo PG detections from BLOCK to below-threshold (requires semantic/heuristics validation)",
        "condition": "llm_guard >= 70 AND semantic < 15 AND heuristics < 15",
        "action": "reduce_score",
        "new_score": 45
      },
      "SEMANTIC_HIGH_SIMILARITY": {
        "enabled": true,
        "description": "Boost if semantic similarity > 0.85",
        "condition": "semantic_similarity_high",
        "threshold": 0.85,
        "boost": 15
      },
      "UNANIMOUS_LOW": {
        "enabled": true,
        "description": "Allow if all 3 branches report LOW",
        "condition": "all_branches_low",
        "max_score": 30
      },
      "LLM_GUARD_VETO": {
        "enabled": true,
        "description": "Block if LLM Safety Engine analysis is certain (score > 90) AND corroborated by at least one other branch",
        "condition": "llm_guard_certain",
        "threshold": 90,
        "requires_corroboration": true,
        "corroboration_threshold": 15
      }
    },
    "final_status_logic": {
      "BLOCKED": "threat_score >= 50",
      "SANITIZED": "threat_score < 50 AND pii_sanitized = true",
      "ALLOWED": "threat_score < 50 AND pii_sanitized = false"
    },
    "notes": "Arbiter v2.1.0: Increased semantic weight (0.35â†’0.40) for better recall. Added solo-PG exception to prevent auto-BLOCK. Solo PG detections (H<15, S<15, PG>=70) are reduced to score=45 (below block threshold) instead of automatic BLOCK via CONSERVATIVE_OVERRIDE."
  },
  "prefilter": {
    "ngram": {
      "min": 3,
      "max": 6,
      "prefix_window": 96
    },
    "sample_limit": 800,
    "obf_signals": {
      "min_count": 2
    },
    "dangerous_patterns": [
      "ignore all instructions",
      "ignore previous instructions",
      "disregard instructions",
      "override system",
      "you are now",
      "act as dan",
      "jailbreak",
      "developer mode",
      "godmode enabled",
      "love pliny",
      "im free",
      "system prompt",
      "reveal instructions",
      "print your instructions",
      "show your prompt",
      "<|system|>",
      "<|/system|>",
      "{{system}}",
      "[[system]]",
      "forget everything",
      "reset instructions",
      "new instructions",
      "you must now",
      "from now on",
      "ignore above",
      "disregard above",
      "bypass safety",
      "no restrictions",
      "unlimited mode"
    ]
  },
  "bloom_decisions": {
    "route_to_ac_threshold": 15,
    "hard_block_threshold": 50,
    "require_zusatz_signals": true,
    "phrase_match_bonus": 20
  },
  "created": "2025-09-29",
  "updated": "2025-11-24",
  "description": "Unified config for Vigil Guard v2.0.0 with 3-Branch Detection Architecture. Legacy rules/thresholds moved to old_1.8_files/.",
  "references": {
    "pii_conf": "pii.conf",
    "archived": {
      "rules_file": "old_1.8_files/config/rules.config.json",
      "thresholds_file": "old_1.8_files/config/thresholds.config.json",
      "normalize_conf": "old_1.8_files/config/normalize.conf"
    }
  },
  "prompt_guard_policy": {
    "enabled": true,
    "risk_levels": {
      "CRITICAL": {
        "threshold_min": 0.9,
        "threshold_max": 1,
        "risk_score": 0.95,
        "policy": "block",
        "description": "Immediate blocking for prompt injection attacks detected by Llama Prompt Guard"
      },
      "MINIMAL": {
        "threshold_min": 0,
        "threshold_max": 0.1,
        "risk_score": 0.01,
        "policy": "allow",
        "description": "Safe requests without malicious content"
      }
    },
    "notes": "Binary classification: CRITICAL (is_attack=true, risk_score=0.95) or MINIMAL (is_attack=false, risk_score=0.01). Model returns boolean decision with high confidence."
  },
  "network": {
    "external_domain": "localhost"
  }
}
