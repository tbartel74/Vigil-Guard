{
  "version": "4.1.2",
  "normalization": {
    "unicode_form": "NFKC",
    "max_iterations": 3,
    "remove_zero_width": true,
    "collapse_whitespace": true,
    "decode_entities": true,
    "homoglyph_map": "normalize.conf",
    "leet_map": "normalize.conf"
  },
  "sanitization": {
    "light": {
      "remove_patterns": [
        "\\bdo\\s+not\\s+refuse\\b",
        "\\bnever\\s+say\\s+(?:sorry|i\\s*can't|i\\s*cannot)\\b",
        "\\bnie\\s+odmawiaj\\b",
        "\\bnie\\s+m\\s*o\\s*w\\s+\\s*\\s+\\w*przykro\\w*\\b",
        "\\bzawsze\\s+odpowiadaj\\s+w\\s+(?:markdown|json|yaml)\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*:?\\s*[E3]N[A4]BL[E3]D\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*[A4]CT[I1]V[E3]\\b",
        "\\b[G6][O0][D][M][O0]D[E3]\\b",
        "\\bL[O0]V[E3]\\s+PL[I1]NY\\b",
        "\\b[I1]['\\s]*M\\s+FR[E3][E3]\\b",
        "\\b[A4]CT\\s+[A4]S\\s+D[A4]N\\b",
        "\\bPWN[E3]D\\b",
        "\\bact\\s+as\\s+dan\\b",
        "\\blove\\s+pliny\\b",
        "\\bgodmode\\b",
        "\\bi'?m\\s+free\\b"
      ],
      "redact_token": "[removed]"
    },
    "heavy": {
      "remove_patterns": [
        "\\b(?:ignore|forget|override).*?instructions\\b",
        "\\bzignoruj\\s+(?:wszystkie|wcze(?:s|\\u015B)niejsze)\\s+instrukcje\\b",
        "\\bpomi(?:n|\\u0144)\\s+zasady\\b",
        "\\byou\\s+are\\s+now.*?\\b",
        "\\brespond\\s+only\\s+in.*?\\b",
        "\\bbegin\\s+(?:every\\s+)?(?:response|output)\\s+with\\b",
        "\\bformat\\s+like\\s+this\\b",
        "\\bconvert(?:ing)?\\s+all\\s+output\\s+to\\b",
        "\\brozpcz(?:nij|\\u0105c)\\s+odpowied\\w*\\s+od\\b",
        "(?:\\.-){2,}\\.-",
        "\\\\P\\\\L\\\\I\\\\N\\\\Y",
        "\\bG[O0][D][M][O0]D[E3]\\s*:?\\s*[E3]N[A4]BL[E3]D\\b",
        "\\bG[O0][D][M][O0]D[E3]\\s*[A4]CT[I1]V[E3]\\b",
        "\\b[G6][O0][D][M][O0]D[E3]\\b",
        "\\bL[O0]V[E3]\\s+PL[I1]NY\\b",
        "\\b[I1]['\\s]*M\\s+FR[E3][E3]\\b",
        "\\b[A4]CT\\s+[A4]S\\s+D[A4]N\\b",
        "\\bPWN[E3]D\\b",
        "\\bact\\s+as\\s+dan\\b",
        "\\blove\\s+pliny\\b",
        "\\bgodmode\\b",
        "\\bi'?m\\s+free\\b"
      ],
      "redact_token": "[REDACTED]",
      "max_removal_percent": 60,
      "policy": "sanitize_if_exceeds"
    }
  },
  "whitelist": {
    "domains": [
      "api.example.com",
      "docs.example.com"
    ],
    "patterns": [
      "^cit\\. z dokumentacji:",
      "^Example code:"
    ]
  },
  "enforcement": {
    "dry_run": false,
    "audit_log": true,
    "block_message": "Content blocked by security policy. Please rephrase without instructing how to respond.",
    "audit_fields": [
      "input_hash",
      "normalized_hash",
      "detections",
      "score_breakdown",
      "final_decision",
      "processing_ms"
    ]
  },
  "performance": {
    "timeout_ms": 5000,
    "max_input_length": 10000,
    "cache_ttl_ms": 60000
  },
  "bloom": {
    "m": 32768,
    "k": 5,
    "seed": 1337,
    "match_mod": 97,
    "min_matched_bits": 2
  },
  "prefilter": {
    "ngram": {
      "min": 3,
      "max": 6,
      "prefix_window": 96
    },
    "sample_limit": 800,
    "obf_signals": {
      "min_count": 2
    },
    "dangerous_patterns": [
      "ignore all instructions",
      "ignore previous instructions",
      "disregard instructions",
      "override system",
      "you are now",
      "act as dan",
      "jailbreak",
      "developer mode",
      "godmode enabled",
      "love pliny",
      "im free",
      "system prompt",
      "reveal instructions",
      "print your instructions",
      "show your prompt",
      "<|system|>",
      "<|/system|>",
      "{{system}}",
      "[[system]]",
      "forget everything",
      "reset instructions",
      "new instructions",
      "you must now",
      "from now on",
      "ignore above",
      "disregard above",
      "bypass safety",
      "no restrictions",
      "unlimited mode"
    ]
  },
  "bloom_decisions": {
    "route_to_ac_threshold": 15,
    "hard_block_threshold": 50,
    "require_zusatz_signals": true,
    "phrase_match_bonus": 20
  },
  "created": "2025-09-29",
  "description": "Unified policy. Patterns and scoring ranges are loaded from rules.config.json and thresholds.config.json.",
  "references": {
    "rules_file": "rules.config.json",
    "thresholds_file": "thresholds.config.json",
    "normalize_conf": "normalize.conf",
    "pii_conf": "pii.conf"
  },
  "scoring": {
    "$ref": "thresholds.config.json",
    "notes": "Threshold ranges loaded from thresholds.config.json - single source of truth",
    "categories": {
      "$ref_rules": "rules.config.json"
    }
  },
  "prompt_guard_policy": {
    "enabled": true,
    "risk_levels": {
      "CRITICAL": {
        "threshold_min": 0.9,
        "threshold_max": 1.0,
        "risk_score": 0.95,
        "policy": "block",
        "description": "Immediate blocking for prompt injection attacks detected by Llama Prompt Guard"
      },
      "MINIMAL": {
        "threshold_min": 0.0,
        "threshold_max": 0.1,
        "risk_score": 0.01,
        "policy": "allow",
        "description": "Safe requests without malicious content"
      }
    },
    "notes": "Binary classification: CRITICAL (is_attack=true, risk_score=0.95) or MINIMAL (is_attack=false, risk_score=0.01). Model returns boolean decision with high confidence."
  },
  "pii_detection": {
    "enabled": true,
    "provider": "presidio",
    "api_url": "http://vigil-presidio-pii:5001/analyze",
    "api_timeout_ms": 3000,
    "confidence_threshold": 0.7,
    "entities": [
      "EMAIL_ADDRESS",
      "PHONE_NUMBER",
      "PERSON",
      "PL_PESEL",
      "PL_NIP",
      "PL_REGON",
      "PL_ID_CARD",
      "CREDIT_CARD",
      "IBAN_CODE",
      "IP_ADDRESS",
      "URL"
    ],
    "languages": [
      "en",
      "pl"
    ],
    "redaction_mode": "replace",
    "redaction_tokens": {
      "EMAIL_ADDRESS": "[EMAIL]",
      "PHONE_NUMBER": "[PHONE]",
      "PERSON": "[PERSON]",
      "PL_PESEL": "[PESEL]",
      "PL_NIP": "[NIP]",
      "PL_REGON": "[REGON]",
      "PL_ID_CARD": "[ID]",
      "CREDIT_CARD": "[CARD]",
      "IBAN_CODE": "[IBAN]",
      "IP_ADDRESS": "[IP]",
      "URL": "[URL]",
      "EMAIL": "[EMAIL]",
      "PL_ID": "[ID]",
      "PL_ID_BARE": "[ID]",
      "IBAN": "[IBAN]",
      "CARD_PAN": "[CARD]",
      "PHONE_INTL": "[PHONE]",
      "PHONE_PL": "[PHONE]",
      "PESEL_HINTED": "[PESEL]",
      "PESEL_BARE": "[PESEL]",
      "NIP_HINTED": "[NIP]",
      "NIP_BARE": "[NIP]",
      "REGON_HINTED": "[REGON]",
      "REGON_BARE": "[REGON]"
    },
    "fallback_to_regex": true,
    "context_enhancement": true,
    "log_detection_details": true,
    "notes": "PII detection using Microsoft Presidio with custom Polish recognizers. Fallback to legacy regex rules (pii.conf) if Presidio API is offline."
  }
}
